<Window x:Class="ThreeDMolecules.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:helix="http://helix-toolkit.org/wpf"
        xmlns:vm="clr-namespace:ThreeDMolecules.ViewModels"
        xmlns:b="clr-namespace:ThreeDMolecules.Behaviors"
        mc:Ignorable="d"
        Title="3DMolecules - 3D Molecular Visualization" Height="900" Width="1600">
    <Window.DataContext>
        <vm:SimulationViewModel />
    </Window.DataContext>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="360" />
        </Grid.ColumnDefinitions>
        <helix:HelixViewport3D x:Name="helixViewport" Grid.Column="0">
            <helix:HelixViewport3D.Camera>
                <PerspectiveCamera Position="0, -30, 10" LookDirection="0,30,-10" UpDirection="0,0,1" FieldOfView="45"/>
            </helix:HelixViewport3D.Camera>
            <ModelVisual3D>
                <ModelVisual3D.Content>
                    <Model3DGroup>
                        <AmbientLight Color="Gray" />
                        <AmbientLight Color="#404040" />
                        <DirectionalLight Color="White" Direction="1,-1,-1" />
                        <DirectionalLight Color="White" Direction="-1,1,1" />
                        <DirectionalLight Color="White" Direction="0,-1,0" />
                    </Model3DGroup>
                </ModelVisual3D.Content>
            </ModelVisual3D>
            <!-- Molecules then boundary (transparent last) -->
            <ModelVisual3D Content="{Binding MoleculesRoot}" />
            <ModelVisual3D Content="{Binding BoundaryRoot}" />
        </helix:HelixViewport3D>
        <ScrollViewer Grid.Column="1" Margin="8" VerticalScrollBarVisibility="Auto">
            <StackPanel Orientation="Vertical" >
                <TextBlock Text="Simulation Controls" FontWeight="Bold" FontSize="16" />
                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                    <Button Command="{Binding StartCommand}" Content="Start" Width="70" Margin="0,0,6,0" />
                    <Button Command="{Binding PauseCommand}" Content="Pause" Width="70" Margin="0,0,6,0" />
                    <Button Command="{Binding ResetCommand}" Content="Reset" Width="70" />
                </StackPanel>
                <TextBlock Text="Status" FontWeight="Bold" Margin="0,16,0,4" />
                <TextBlock Text="{Binding Fps, StringFormat=FPS: {0:F1}}" />
                <TextBlock Text="{Binding IsRunning, StringFormat=Running: {0}}" />
                <TextBlock Text="{Binding Molecules.Count, StringFormat=Molecules: {0}}" />
                <TextBlock Text="{Binding Diagnostics}" TextWrapping="Wrap" Margin="0,4,0,0" FontSize="10" Foreground="Gray"/>

                <TextBlock Text="Molecule Count" FontWeight="Bold" Margin="0,16,0,4" />
                <StackPanel Margin="0,4,0,0">
                    <Slider Minimum="0" Maximum="480" Value="{Binding MoleculeCount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" TickFrequency="20" IsSnapToTickEnabled="False"/>
                    <TextBlock Text="{Binding MoleculeCount, StringFormat=Current: {0}}" />
                </StackPanel>

                <TextBlock Text="Tilt (deg)" FontWeight="Bold" Margin="0,16,0,4" />
                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                    <TextBlock Text="X:" VerticalAlignment="Center" Margin="0,0,4,0" />
                    <Slider Minimum="-80" Maximum="80" Width="130" Value="{Binding TiltX, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    <TextBlock Text="Y:" VerticalAlignment="Center" Margin="12,0,4,0" />
                    <Slider Minimum="-80" Maximum="80" Width="130" Value="{Binding TiltY, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>

                <TextBlock Text="Simulation Settings" FontWeight="Bold" Margin="0,16,0,4" />
                <StackPanel>
                    <TextBlock Text="Time Step"/>
                    <Slider Minimum="0.02" Maximum="1.0" IsSnapToTickEnabled="True" TickFrequency="0.1" Value="{Binding Parameters.DefaultTimeStep, Mode=TwoWay}"/>

                    <TextBlock Text="Gravity"/>
                    <Slider Minimum="-0.2" Maximum="0.2" Value="{Binding Parameters.Gravity, Mode=TwoWay}"
                            b:SliderBehavior.CenterValue="0" b:SliderBehavior.CenterSnapThreshold="0.01"/>

                    <TextBlock Text="Preferred Spacing"/>
                    <Slider Minimum="1.0" Maximum="4.0" Value="{Binding Parameters.PreferredSpacing, Mode=TwoWay}"/>

                    <TextBlock Text="Cohesion Distance"/>
                    <Slider Minimum="1.5" Maximum="4.0" Value="{Binding Parameters.CohesionDistance, Mode=TwoWay}"/>

                    <TextBlock Text="Cohesion Strength"/>
                    <Slider Minimum="0" Maximum="0.1" SmallChange="0.001" LargeChange="0.01" Value="{Binding Parameters.CohesionStrength, Mode=TwoWay}"/>

                    <TextBlock Text="Liquid Stiffness"/>
                    <Slider Minimum="0" Maximum="0.5" Value="{Binding Parameters.LiquidStiffness, Mode=TwoWay}"/>

                    <TextBlock Text="Near Stiffness"/>
                    <Slider Minimum="0" Maximum="1.0" Value="{Binding Parameters.LiquidNearStiffness, Mode=TwoWay}"/>

                    <TextBlock Text="Viscosity"/>
                    <Slider Minimum="0" Maximum="1.0" Value="{Binding Parameters.Viscosity, Mode=TwoWay}"/>

                    <TextBlock Text="Linear Damping"/>
                    <Slider Minimum="0" Maximum="0.2" Value="{Binding Parameters.LinearDamping, Mode=TwoWay}"/>

                    <TextBlock Text="Max Speed"/>
                    <Slider Minimum="0" Maximum="0.2" Value="{Binding Parameters.MaxSpeed, Mode=TwoWay}"/>

                    <TextBlock Text="Restitution"/>
                    <Slider Minimum="0" Maximum="1.0" Value="{Binding Parameters.CollisionRestitution, Mode=TwoWay}"/>

                    <TextBlock Text="Separation Force"/>
                    <Slider Minimum="0" Maximum="0.5" Value="{Binding Parameters.SeparationForce, Mode=TwoWay}"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
